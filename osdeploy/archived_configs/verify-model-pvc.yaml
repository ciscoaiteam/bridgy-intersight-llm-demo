apiVersion: v1
kind: Pod
metadata:
  name: vllm-pvc-verify
  labels:
    app: vllm-verify
spec:
  serviceAccountName: vllm-sa
  securityContext:
    runAsUser: 1000
    fsGroup: 1000
    fsGroupChangePolicy: "OnRootMismatch"
  containers:
  - name: verify
    image: image-registry.openshift-image-registry.svc:5000/demo1/vllm-server:latest
    command: ["bash", "-c"]
    args:
    - |
      echo "Verifying PVC contents..."
      echo "Models directory:"
      ls -la /data/models
      echo
      echo "Gemma 2 model directory:"
      ls -la /data/models/gemma-2-9b-it || echo "Directory not found"
      echo
      echo "Huggingface directory:"
      ls -la /data/huggingface || echo "Directory not found"
      echo
      echo "Checking directory permissions:"
      echo "Models dir write test:"
      touch /data/models/write-test && echo "Success" || echo "Failed"
      echo "Huggingface dir write test:"
      touch /data/huggingface/write-test && echo "Success" || echo "Failed"
      rm -f /data/models/write-test /data/huggingface/write-test
      echo "Done."
    volumeMounts:
    - name: vllm-models
      mountPath: "/data/models"
    - name: vllm-huggingface
      mountPath: "/data/huggingface"
  restartPolicy: Never
  volumes:
  - name: vllm-models
    persistentVolumeClaim:
      claimName: vllm-models
  - name: vllm-huggingface
    persistentVolumeClaim:
      claimName: vllm-huggingface
